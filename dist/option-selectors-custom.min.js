!function(global,factory){if("function"==typeof define&&define.amd)define(["module"],factory);else if("undefined"!=typeof exports)factory(module);else{var mod={exports:{}};factory(mod),global.optionSelectorsCustom=mod.exports}}(this,function(module){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),OptionSelectorsCustom=function(){function OptionSelectorsCustom(data){_classCallCheck(this,OptionSelectorsCustom),this.data=data,this.elem=document.querySelector(this.data.element),this.template=this.data.template,this.templateBuilder=this.data.templateBuilder,this.product=new window.Shopify.Product(this.data.product),this.callback=this.data.callback,this.history=this.data.enableHistory&&new HistoryState,this.selectors={},this.hideOriginalSelector(),this.buildSelectors(),window.Shopify.urlParam("variant")?this.selectFromParams():this.selectInitials()}return _createClass(OptionSelectorsCustom,[{key:"hideOriginalSelector",value:function(){this.elem.style.display="none"}},{key:"updateSelectors",value:function(selector,e){var variant=this.product.getVariant(this.selectedValues());if(this.callback.call(this,variant,selector,e),null!=variant){this.elem.value=variant.id;var event=void 0;/Edge\/|Trident\/|MSIE /.test(window.navigator.userAgent)?(event=document.createEvent("Event"),event.initEvent("change",!1,!0)):event=new Event("change"),this.elem.dispatchEvent(event),this.history&&this.history.onSelection(variant)}}},{key:"createSelectorListener",value:function(item){for(var self=this,selector="string"==typeof item?this.selectors[item]:item,children=selector.element().querySelector(".options").children,clickCallback=function(e){selector.clearSelection(),selector.makeSelection(this),self.updateSelectors(selector,e)},i=0;i<children.length;i+=1)children[i].addEventListener("click",clickCallback)}},{key:"buildSelectors",value:function(){for(var optionNames=this.product.optionNames(),i=0;i<optionNames.length;i+=1){var singleSelector=new SingleOptionSelectorCustom({option:{id:"option"+(i+1),name:optionNames[i],values:this.product.optionValues(i)},template:this.template,templateBuilder:this.templateBuilder,selectedClass:this.data.selectedClass,product:this.product});this.selectors[singleSelector.id]=singleSelector,this.elem.insertAdjacentHTML("beforebegin",singleSelector.buildSelector()),this.createSelectorListener(singleSelector.id)}}},{key:"selectInitials",value:function(){for(var _this=this,availableVariant=null,variants=this.product.variants,i=0;i<variants.length;i+=1)if(variants[i].available){availableVariant=variants[i];break}availableVariant?this.selectFromParams(availableVariant.id):(Object.keys(this.selectors).forEach(function(optionId){_this.selectors[optionId].clearSelection(),_this.selectors[optionId].makeSelection(0)}),this.updateSelectors())}},{key:"selectedValues",value:function(){var _this2=this,selected=[];return Object.keys(this.selectors).forEach(function(optionId){var selection=_this2.selectors[optionId].currentSelection();selection&&selected.push(selection.getAttribute("data-value"))}),selected}},{key:"selectFromParams",value:function(variantId){var id=variantId||window.Shopify.urlParam("variant");if(id){var variant=this.product.getVariantById(id);if(!variant)return;for(var i=0;i<variant.options.length;i+=1)for(var selector=this.selectors["option"+(i+1)],children=selector.element().querySelector(".options").children,x=0;x<children.length;x+=1)children[x].getAttribute("data-value")===variant.options[i]&&selector.makeSelection(children[x]);this.updateSelectors()}}}]),OptionSelectorsCustom}(),SingleOptionSelectorCustom=function(){function SingleOptionSelectorCustom(data){_classCallCheck(this,SingleOptionSelectorCustom),this.name=data.option.name,this.values=data.option.values,this.id=data.option.id,this.template=data.template,this.templateBuilder=data.templateBuilder,this.selectedClass=data.selectedClass,this.product=data.product}return _createClass(SingleOptionSelectorCustom,[{key:"buildSelector",value:function(){return this.templateBuilder.call(this)}},{key:"element",value:function(){return document.getElementById("selector-"+this.product.id+"-"+this.id)}},{key:"currentSelection",value:function(){return this.element().querySelector("."+this.selectedClass)}},{key:"clearSelection",value:function(){var currentlySelected=this.element().querySelector("."+this.selectedClass);if(currentlySelected){for(var regex=new RegExp("(^|\\s)"+this.selectedClass+"(\\s|$)","gi"),classes=currentlySelected.className.split(/\s+/g).length,i=0;i<classes;i+=1)currentlySelected.className=currentlySelected.className.replace(regex," ");currentlySelected.className=currentlySelected.className.trim()}}},{key:"makeSelection",value:function(child){"number"==typeof child&&(child=this.element().querySelector(".options").children[child]);var classes=child.className.split(/\s+/g);classes.push(this.selectedClass),child.className=classes.join(" ").replace(/^[\s]+/gi,"")}}]),SingleOptionSelectorCustom}(),HistoryState=function(){function HistoryState(){_classCallCheck(this,HistoryState),this.supported=window.history&&window.history.replaceState}return _createClass(HistoryState,[{key:"onSelection",value:function(variant){this.supported&&window.Shopify.setParam("variant",variant.id)}}]),HistoryState}();module.exports=OptionSelectorsCustom});